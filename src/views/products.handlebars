<div class="container my-5">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="text-primary">Lista de productos</h1>
    <a href="/carts/688e355d813e7eaf8f109819" class="btn btn-outline-primary">
      🛒 Ver Carrito
    </a>
  </div>

  <h1>Lista de productos</h1>

<div class="products-grid">
  {{#each products}}
    <div class="product-card">
      <img src="{{this.thumbnails.[0]}}" alt="{{this.title}}" />
      <h2>{{this.title}}</h2>
      <p><strong>Precio:</strong> ${{this.price}}</p>
      <p>{{this.description}}</p>

      <div class="row gap-8">
        <label for="qty-{{this._id}}">Cantidad:</label>
        <input id="qty-{{this._id}}" type="number" min="1" value="1" class="qty-input" data-id="{{this._id}}" />
      </div>

      <button class="add-to-cart" data-id="{{this._id}}">Agregar al carrito</button>
    </div>
  {{/each}}
</div>

<div class="pagination">
  {{#if hasPrevPage}}
    <a href="?page={{prevPage}}&limit={{limit}}&sort={{sort}}&query={{query}}">⬅ Anterior</a>
  {{/if}}

  <span>Página {{page}} de {{totalPages}}</span>

  {{#if hasNextPage}}
    <a href="?page={{nextPage}}&limit={{limit}}&sort={{sort}}&query={{query}}">Siguiente ➡</a>
  {{/if}}
</div>

<div style="margin-top:16px">
  <!-- Cambiá este ID por el tuyo mientras tanto -->
  <a class="btn" href="/carts/688e355d813e7eaf8f109819">Ver carrito</a>
</div>

<script>
  // ⚠️ Reemplazá por tu cartId real o ponelo en una variable de entorno/render
  const CART_ID = '688e355d813e7eaf8f109819';

  document.querySelectorAll('.add-to-cart').forEach(btn => {
    btn.addEventListener('click', async () => {
      const pid = btn.dataset.id;
      const qtyInput = document.querySelector(`#qty-${pid}`);
      const quantity = Number(qtyInput?.value || 1);

      try {
        const res = await fetch(`/api/carts/${CART_ID}/products/${pid}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ quantity }) // <<----- acá va la cantidad por body
        });

        const data = await res.json();
        if (!res.ok) {
          alert(data.error || 'Error al agregar');
          return;
        }
        alert('Agregado al carrito');
      } catch (err) {
        console.error(err);
        alert('Error de red');
      }
    });
  });
</script>